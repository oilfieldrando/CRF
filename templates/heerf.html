{% load bootstrap4 %}
{% load static %}
{% load humanize %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name ="viewport" content= "width=device-width,initial-scale=1, shrink-to-fit=no">


{% bootstrap_css %}
{% bootstrap_javascript jquery='full' %}

</head>

<body>

<nav class="navbar sticky-top navbar-expand-md navbar-dark bg-dark mb-4 border">
    
    <a class="navbar-brand" href="{% url 'blog:home'%}">
        
        <img src="https://d3346f13f1pt3f.cloudfront.net/static/logo-banner.png" style= "max-height:30px" alt="...">
        
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse"
    data-target="#navbarCollapse" aria-controls="navbarCollapse"
    aria-expanded="false" aria-label="Toggle navigation">
    
    <span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'blog:bill_breakdowns'%}">
                Breakdowns</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="{% url 'blog:thinkpieces'%}">
                Thinkpieces</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'blog:roundups'%}">
                Weekly Roundup</a>
            </li>
        </ul>
        
    </div>
</nav>
   
<main role="main" class="container">
  <h4>HEERF Funds Dashboard</h4>
  <div class="pb-2 mb-2 border-bottom"></div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.1.1/dist/chart.min.js"></script>
 
<div class="text-center">
  <h3>Higher Education Relief Funds by State</h3>
</div>
  
  <div class="col-lg-3" style="float: left;  height: 1200px;max-width:800px;"> 
    <canvas id="myChart" style="height: 1200px; max-width: 1000px;"></canvas>
  </div>

  <script>
    const labels = {{state_labels|safe}};
  const data = {
    labels: labels,
    datasets: [
      {
        axis: 'y',
        label: 'CARES Act',
        data: {{state_cares|safe}},
        fill: false,
        backgroundColor: ['rgba(255, 0, 0, 0.2)'],
        borderColor: ['rgb(255, 0, 0)'],
        borderWidth: 1,
        
        
      },
      {
        axis: 'y',
        label: 'Omnibus',
        data: {{state_omnibus|safe}},
        fill: false,
        backgroundColor: ['rgba(0, 0, 255, 0.2)'],
        borderColor: ['rgb(0, 0, 255)'],
        borderWidth: 1,
       
        
      },
      {
        axis: 'y',
        label: 'Amer. Rescue Act',
        data: {{state_ara|safe}},
        fill: false,
        backgroundColor: ['rgba(255, 128, 0, 0.2)'],
        borderColor: ['rgb(255, 128, 0)'],
        borderWidth: 1,
        
        
      }
    ]
  };
  
  
  
  const config = {
    type: 'bar',
    data,
    options: {
      plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        var label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        if (context.parsed.x !== null) {
                            label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD',maximumFractionDigits:0 }).format(context.parsed.x);
                        }
                        return label;
                    }
                }
            }
        },
       
      maintainAspectRatio: false,
      indexAxis: 'y',
      scales: {
        x: {
          ticks: {
            callback: function(value, index, values) {
                  if (parseInt(value) >= 1000) {
                     return '$' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                  } else {
                     return '$' + value;
                  }
            },
            
            
            
          },
          stacked: true,
          barPercentage:1,
          
        },
        y: {stacked: true},
         
      }
    }
  };

    var myChart = new Chart(
    document.getElementById('myChart'),
    config
  );
  </script>
<div class="container">
<div class="table-responsive" style="max-width:400px;text-left">

<table class="table-sm table-bordered">
  <thead>
    <tr>
      <th scope="col">State/Territory</th>
      <th scope="col">Total Relief</th>
    </tr>
  </thead>
  <tbody>
  {% for i in data%}
    <tr>
      <td>{{i.state}}</td>
      <td>${{i.total_relief|floatformat:0|intcomma}}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
</div>
</div>



